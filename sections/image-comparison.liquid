{% if section.settings.image_left and section.settings.image_right %}
<div class="comparison-wrapper" data-section-id="{{ section.id }}">

  {% if section.settings.title != blank %}
    <div class="comparison-header">
    {% if section.settings.subtitle != blank %}
        <p class="comparison-subtitle">{{ section.settings.subtitle }}</p>
    {% endif %}
      <h2 class="comparison-title">{{ section.settings.title }}</h2>
    </div>
  {% endif %}

  <!-- Desktop labels -->
  <div class="comparison-labels desktop-only">
    <span class="label left-label">
      {{ section.settings.label_left | newline_to_br }}
    </span>

    <span class="label right-label">
      {{ section.settings.label_right | newline_to_br }}
    </span>
  </div>

  <div
    class="comparison-container"
    style="--start: {{ section.settings.start_position }}%;"
    --radius: {{ section.settings.border_radius }}px;
  >
    <img
      src="{{ section.settings.image_left | image_url: width: 2000 }}"
      alt="{{ section.settings.label_left }}"
      class="comparison-image image-left"
      loading="lazy"
    >

    <div class="image-right-wrapper">
      <img
        src="{{ section.settings.image_right | image_url: width: 2000 }}"
        alt="{{ section.settings.label_right }}"
        class="comparison-image image-right"
        loading="lazy"
      >
    </div>

    <!-- Mobile labels (inside image) -->
    <span class="label left-label mobile-only">
      {{ section.settings.label_left | newline_to_br }}
    </span>

    <span class="label right-label mobile-only">
      {{ section.settings.label_right | newline_to_br }}
    </span>

    <div class="slider-handle">
    <span class="slider-line"></span>
    <span class="slider-circle">
      <img
        src="https://cdn.shopify.com/s/files/1/0692/6807/8666/files/control-icon.svg?v=1770732966"
        class="slider-icon"
        alt=""
      >
    </span>
  </div>
  </div>
</div>
{% endif %}

<style>
.comparison-wrapper {
  width: 100%;
  padding: 60px 0;
}

.slider-icon {
  width: 40px;
  height: 40px;
  display: block;
}

/* Header */
.comparison-header {
  text-align: center;
  margin-bottom: 24px;
}

.comparison-title {
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 8px;
}

.comparison-subtitle {
  font-size: 14px;
  color: #666;
}

/* Desktop labels */
.comparison-labels {
  max-width: 1200px;
  margin: 0 auto 12px;
  display: flex;
  justify-content: space-between;
  
}

.label {
  font-size: 12px;
  letter-spacing: 1px;
  text-transform: uppercase;
  background: rgba(255,255,255,0.75);
  padding: 6px 10px;
}

/* Image comparison */
.comparison-container {
  position: relative;
  max-width: 1200px;
  margin: 0 auto;
  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: var(--radius, 12px);
}

.comparison-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.image-left {
  position: absolute;
  inset: 0;
}

.image-right-wrapper {
  position: absolute;
  inset: 0;
  width: var(--start);
  overflow: hidden;
}

.image-right {
  position: absolute;
  inset: 0;
}

/* Mobile labels inside image */
.mobile-only {
  display: none;
  position: absolute;
  top: 12px;
  z-index: 5;
}

.mobile-only.left-label {
  left: 12px;
}

.mobile-only.right-label {
  right: 12px;
}

/* Slider */
.slider-handle {
  position: absolute;
  top: 0;
  left: var(--start);
  transform: translateX(-50%);
  width: 40px;
  height: 100%;
  cursor: ew-resize;
  z-index: 10;
}

.slider-line {
  position: absolute;
  left: 50%;
  width: 2px;
  height: 100%;
  background: white;
  transform: translateX(-50%);
}

.slider-circle {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Evita que el SVG o IMG bloquee el drag */
.slider-circle,
.slider-circle img,
.slider-circle svg {
  pointer-events: none;
}

/* El handle S√ç recibe eventos */
.slider-handle {
  pointer-events: auto;
  touch-action: none; /* CLAVE en mobile */
}


/* Responsive */
.desktop-only {
  display: flex;
}

@media (max-width: 768px) {
  .desktop-only {
    display: none;
  }

  .mobile-only {
    display: block;
  }

  .comparison-title {
    font-size: 22px;
  }

  .comparison-subtitle {
    font-size: 13px;
  } 

  .comparison-container {
    border-radius: calc(var(--radius) / 2);
  }

}

</style>

<script>
(() => {
  const section = document.querySelector('[data-section-id="{{ section.id }}"]');
  if (!section) return;

  const container = section.querySelector('.comparison-container');
  const slider = section.querySelector('.slider-handle');
  const rightImage = section.querySelector('.image-right-wrapper');

  let dragging = false;

  function move(clientX) {
    const rect = container.getBoundingClientRect();
    let pos = clientX - rect.left;
    pos = Math.max(0, Math.min(pos, rect.width));

    const percent = (pos / rect.width) * 100;
    slider.style.left = percent + '%';
    rightImage.style.width = percent + '%';
  }

  const startDrag = e => {
    dragging = true;
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    move(x);
  };

  const onDrag = e => {
    if (!dragging) return;
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    move(x);
  };

  const stopDrag = () => dragging = false;

  slider.addEventListener('mousedown', startDrag);
  slider.addEventListener('touchstart', startDrag, { passive: true });

  window.addEventListener('mousemove', onDrag);
  window.addEventListener('touchmove', onDrag, { passive: true });

  window.addEventListener('mouseup', stopDrag);
  window.addEventListener('touchend', stopDrag);
})();
</script>


{% schema %}
{
  "name": "Image comparison slider",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section title",
      "default": "See the Difference"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Section subtitle",
      "default": "Compare image quality side by side"
    },
    {
      "type": "image_picker",
      "id": "image_left",
      "label": "Left image"
    },
    {
      "type": "image_picker",
      "id": "image_right",
      "label": "Right image"
    },
    {
      "type": "text",
      "id": "label_left",
      "label": "Left label",
      "default": "SHOT ON\nREPLICA CAMERA"
    },
    {
      "type": "text",
      "id": "label_right",
      "label": "Right label",
      "default": "SHOT ON\nCHUZHAO"
    },
    {
        "type": "range",
        "id": "border_radius",
        "label": "Image border radius (px)",
        "min": 0,
        "max": 40,
        "step": 2,
        "default": 12
    },   
    {
      "type": "range",
      "id": "start_position",
      "label": "Initial slider position (%)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 50
    }
  ],
  "presets": [
    {
      "name": "Image comparison"
    }
  ]
}
{% endschema %}
