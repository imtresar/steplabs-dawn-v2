{% schema %}
{
  "name": "Image comparison",
  "settings": [
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "CHUZHAOâ„¢ THE ORIGINAL DIGITAL TLR 2.0"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "The difference shows after the moment passes"
    },
    {
      "type": "image_picker",
      "id": "image_left",
      "label": "Left image"
    },
    {
      "type": "image_picker",
      "id": "image_right",
      "label": "Right image"
    },
    {
      "type": "text",
      "id": "label_left",
      "label": "Left label",
      "default": "SHOT ON REPLICA CAMERA"
    },
    {
      "type": "text",
      "id": "label_right",
      "label": "Right label",
      "default": "SHOT ON CHUZHAO"
    },
    {
      "type": "range",
      "id": "start_position",
      "label": "Initial slider position (%)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 50
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Image border radius (px)",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Image comparison"
    }
  ]
}
{% endschema %}

<style>
.comparison-editorial {
  max-width: 1200px;
  margin: 0 auto;
  padding: 64px 20px;
}

/* Header */
.comparison-header {
  text-align: center;
  margin-bottom: 24px;
}

.comparison-subtitle {
  font-size: 12px;
  letter-spacing: 1.2px;
  text-transform: uppercase;
  margin-bottom: 8px;
  opacity: 0.7;
}

.comparison-title {
  font-size: 32px;
  font-weight: 500;
  line-height: 1.2;
}

/* Labels outside image */
.comparison-labels {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 8px;
  padding: 0 8px;
}

/* Comparison */
.comparison-container {
  position: relative;
  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: var(--radius);
}

.comparison-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.image-left {
  position: absolute;
  inset: 0;
}

.image-right-wrapper {
  position: absolute;
  inset: 0;
  width: var(--start);
  overflow: hidden;
}

.image-right {
  position: absolute;
  inset: 0;
}

/* Slider */
.slider-handle {
  position: absolute;
  top: 0;
  left: var(--start);
  transform: translateX(-50%);
  width: 40px;
  height: 100%;
  cursor: ew-resize;
  z-index: 5;
}

.slider-line {
  position: absolute;
  left: 50%;
  width: 2px;
  height: 100%;
  background: white;
  transform: translateX(-50%);
}

.slider-circle {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 36px;
  height: 36px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.25);
}
</style>

<script>
(() => {
  const section = document.querySelector('[data-section-id="{{ section.id }}"]');
  if (!section) return;

  const container = section.querySelector('.comparison-container');
  const slider = section.querySelector('.slider-handle');
  const rightImage = section.querySelector('.image-right-wrapper');

  let dragging = false;

  function move(x) {
    const rect = container.getBoundingClientRect();
    let pos = x - rect.left;
    pos = Math.max(0, Math.min(pos, rect.width));

    const percent = (pos / rect.width) * 100;
    slider.style.left = percent + '%';
    rightImage.style.width = percent + '%';
  }

  slider.addEventListener('mousedown', () => dragging = true);
  window.addEventListener('mouseup', () => dragging = false);
  window.addEventListener('mousemove', e => dragging && move(e.clientX));

  slider.addEventListener('touchstart', () => dragging = true);
  window.addEventListener('touchend', () => dragging = false);
  window.addEventListener('touchmove', e => {
    if (dragging) move(e.touches[0].clientX);
  });
})();
</script>

